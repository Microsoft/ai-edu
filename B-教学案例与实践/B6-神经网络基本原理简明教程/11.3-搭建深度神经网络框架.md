Copyright © Microsoft Corporation. All rights reserved.
  适用于[License](https://github.com/Microsoft/ai-edu/blob/master/LICENSE.md)版权许可

# 图片数据归一化

木头：在第5/6两章中，我们已经用了数据归一化大法，否则有可能根本训练不出结果，如第5章中的房价数据，或者训练速度很慢，如第6章中的污染物分类。在这一章中，我看到我们使用了不一样的归一化数据处理方法，这是为什么呢？

下面这段代码是第5/6两章中使用的数据归一化方法：
```Python
def NormalizeData(X):
    X_NEW = np.zeros(X.shape)
    # get number of features
    n = X.shape[0]
    for i in range(n):
        x_row = X[i,:]
        x_max = np.max(x_row)
        x_min = np.min(x_row)
        if x_max != x_min:
            x_new = (x_row - x_min)/(x_max-x_min)
            X_NEW[i,:] = x_new
    return X_NEW
```

下面这段代码是第10章中使用的数据归一化方法：
```Python
def NormalizeData(X):
    X_NEW = np.zeros(X.shape)
    x_max = np.max(X)
    x_min = np.min(X)
    X_NEW = (X - x_min)/(x_max-x_min)
    return X_NEW
```

铁柱：眼神儿不错啊！很细心！你可以先把第5/6两章中的样本数据拿来咱们一起看看。

木头：好嘞！...（5分钟后）...我把样本数据列在下面了：

|样本序号|1|2|3|4|...|1000|
|---|---|----|---|--|--|--|
|朝向|1|4|2|4|...|2|
|地理位置|3|2|6|3|...|3|
|面积|96|100|54|72|...|69|
|价格|434|500|321|482|...|410|

|样本序号|1|2|3|4|...|200|
|---|---|----|---|--|--|--|
|温度|0|13|2|24|...|8|
|湿度|55|14|46|58|...|78|
|污染物|0|2|1|2|...|0|

铁柱：好，你看看这两个样本与手写体识别的样本比较，有什么区别？

木头：（抓耳挠腮5分钟）... 怎么看啊？没法比较啊？

铁柱：（喝了口绿茶）提示一下，主要看数值方面。

木头：（喝了口二锅头）... 啊！有点儿明白了，这两个数据，样本的每个特征值的取值范围与其它特征值都不同，比如房屋朝向取值[1,4]，地理位置取值[2,6]，面积取值[50,140]。污染物的温度取值[0,40]，湿度取值[0,100]。

铁柱：嗯嗯！那么MNIST的数据呢？

木头：MNIST的数据全是[0,255]，我们是这样排列的：

|样本序号|1|2|3|4|...|60000|
|---|---|----|---|--|--|--|
|点1|0|0|0|0|...|0|
|点2|0|0|12|0|...|59|
|点3|0|0|56|253|...|98|
|点m|0|23|148|0|...|0|
|点784|0|0|0|0|...|0|

也就是说，数据虽然分成多个特征值（行），但是每个特征的取值范围实际上都是[0,255]。

铁柱：对！咱们在第5/6章中的归一化代码，输入是整个表格X，先得到X.shape[0]，也就是特征值的数量，然后逐行做归一化，也就是说房屋朝向和地理位置的归一化范围并不相同。而第10章中，所有数据全是[0,255]，如果逐行归一，很可能出现这种情况：

- 有一行的数据是：(2,23,148,...3,45)，最大值是148，最小值是2，那么就会把2归一为0，把148归一为1。
- 而在另外一行的数据可能是：(0,3,248,...13,4)，会把0归一为0，把248归一为1。

这样的话，这两行的数据就不可比了，也就是说，本来都是点阵数据，表示灰度的，却被人为地改变了数据的相对值。

木头：哦！对！把图像的二维点阵处理成一维的特征值，是为了计算方便，并不是要改变点阵本身的数值特性。但是，老师，如果不小心这样做了，会有什么问题吗？

铁柱：对于这个手写识别的例子来说，没有多大影响，因为每个特征之间没什么联系，值的相对变化不会影响训练结果。对于别的例子就不好说了，以后咱们遇到时再分析。


|flag = 1, 随机初始化|flag = 2, Xavier初始化|
|---|---|
|rate=9040 / 10000 = 0.9040%|rate=9407 / 10000 = 0.9407%|
|<img src="./Images/10/Init-Random.png">|<img src="./Images/10/Init-Xavier.png">|

